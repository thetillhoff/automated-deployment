- name: check current favorites of gnome bar
  become: true
  become_user: "{{ user }}"
  shell: dconf read /org/gnome/shell/favorite-apps
  register: r_current_gnome_favorites
  changed_when: no
- set_fact:
    current_gnome_favorites: "{{ r_current_gnome_favorites.stdout | string }}"
    wanted_gnome_favorites: "{{ gnome_favorites | to_json | string }}"
- name: set favorites of gnome bar
  become: true
  become_user: "{{ user }}"
  shell: "dconf write /org/gnome/shell/favorite-apps '{{ gnome_favorites | to_json }}'"
  when: current_gnome_favorites != wanted_gnome_favorites


# strange behaviour: while both variables are absoultely equal on debug and copy to file, their hashes are different.
#- debug: var=current_gnome_favorites
#- debug: var=wanted_gnome_favorites
#- copy: "content={{ wanted_gnome_favorites }} dest=/home/dev/workspace/automated_deployment/test_wanted.json"
#- copy: "content={{ current_gnome_favorites }} dest=/home/dev/workspace/automated_deployment/test_current.json"
#- debug:
#    msg: "{{ current_gnome_favorites | hash('sha1') }}"
#- debug:
#    msg: "{{ wanted_gnome_favorites | hash('sha1') }}"
